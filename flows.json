[
    {
        "id": "98134dc27988aaee",
        "type": "tab",
        "label": "LINE è¨Šæ¯å›è¦†",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "7869048476b3fc65",
        "type": "junction",
        "z": "98134dc27988aaee",
        "x": 1320,
        "y": 220,
        "wires": [
            []
        ]
    },
    {
        "id": "153dca1fc08fadbe",
        "type": "http in",
        "z": "98134dc27988aaee",
        "name": "ç›£è½LINE ",
        "url": "/line_hook",
        "method": "post",
        "upload": false,
        "swaggerDoc": "",
        "x": 180,
        "y": 400,
        "wires": [
            [
                "bbb4dab0c25010e7"
            ]
        ]
    },
    {
        "id": "390c0602fa3e523e",
        "type": "debug",
        "z": "98134dc27988aaee",
        "name": "Messaging API åŸå§‹è¼¸å…¥",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 670,
        "y": 260,
        "wires": []
    },
    {
        "id": "0d4ebcd4a9de581f",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "æ“·å–è³‡è¨Š",
        "func": "let data = {};\nif (msg.payload.events[0] == undefined){\n    return;\n}\n\nlet apiData = msg.payload.events[0];\n\nif (apiData.type == \"message\"){\n    data.replyToken = apiData.replyToken;\n    data.msgType = apiData.message.type;\n    data.source = apiData.source.type;\n    data.userId = apiData.source.userId;\n\n    if (data.source == \"group\"){\n        data.groupId = apiData.source.groupId;\n    }\n\n    switch (data.msgType){\n        case \"text\":\n            data.query = apiData.message.text;\n        case \"image\":\n            data.imageId = apiData.message.id;\n    }\n}\nmsg.data = data;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 540,
        "wires": [
            [
                "77782297026a2d6c",
                "6f3c4370d1f46940"
            ]
        ]
    },
    {
        "id": "77782297026a2d6c",
        "type": "debug",
        "z": "98134dc27988aaee",
        "name": "æ“·å–çš„è³‡è¨Š",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "data",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 930,
        "y": 460,
        "wires": []
    },
    {
        "id": "dc29a6294a83159a",
        "type": "http response",
        "z": "98134dc27988aaee",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 620,
        "y": 400,
        "wires": []
    },
    {
        "id": "6f3c4370d1f46940",
        "type": "switch",
        "z": "98134dc27988aaee",
        "name": "è¨Šæ¯é¡å‹",
        "property": "data.msgType",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "text",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "image",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1080,
        "y": 540,
        "wires": [
            [
                "791355f27b03e05c"
            ],
            [
                "4ac82917d127596a"
            ]
        ]
    },
    {
        "id": "47caebfdb8682256",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "å‚³é€ä¿¡æ¯",
        "func": "let channelAccessToken = \"q5QZRPntU/T/BpmuRZLuamwsqd8OqRtgwwwSBo65QVVBZdglbE8IEphTsWrgWN2qvZ16ScXbmuMgUHmpE5Vv84XnXQteYZ7fpfI+7/bQMhrg7hqcuqTW3AYzuPQLMV/FE/1WkXdBSqgQNtI60gSB3gdB04t89/1O/w1cDnyilFU=\";\n\nlet message = {\n    type:'text',\n    text: `${msg.data.replyMsg}`\n};\n\nlet headers = {\n    'Content-Type': 'application/json; charset=UTF-8',\n    'Authorization': 'Bearer ' + channelAccessToken,\n};\nlet payload = {\n    \"replyToken\": msg.data.replyToken,\n    'messages': [message]\n};\nmsg.headers = headers;\nmsg.payload = payload;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2180,
        "y": 620,
        "wires": [
            [
                "5b26e3031a116f92"
            ]
        ]
    },
    {
        "id": "5b26e3031a116f92",
        "type": "http request",
        "z": "98134dc27988aaee",
        "name": "Messaging API å‚³é€",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.line.me/v2/bot/message/reply",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 2400,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "06a7a299ab6009bd",
        "type": "http request",
        "z": "98134dc27988aaee",
        "name": "Messaging API å–å¾—åœ–ç‰‡",
        "method": "use",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1690,
        "y": 620,
        "wires": [
            [
                "12e43af8a9321f2a"
            ]
        ]
    },
    {
        "id": "4ac82917d127596a",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "æº–å‚™æŸ¥è©¢åœ–ç‰‡è«‹æ±‚",
        "func": "let channelAccessToken = 'q5QZRPntU/T/BpmuRZLuamwsqd8OqRtgwwwSBo65QVVBZdglbE8IEphTsWrgWN2qvZ16ScXbmuMgUHmpE5Vv84XnXQteYZ7fpfI+7/bQMhrg7hqcuqTW3AYzuPQLMV/FE/1WkXdBSqgQNtI60gSB3gdB04t89/1O/w1cDnyilFU=';\n\nmsg.url = `https://api-data.line.me/v2/bot/message/${msg.data.imageId}/content`\nmsg.method = \"GET\";\n\nmsg.headers = { \n    \"Authorization\": `Bearer ${channelAccessToken}`, \n    \"Content-Type\": \"application/json\" \n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1450,
        "y": 620,
        "wires": [
            [
                "06a7a299ab6009bd"
            ]
        ]
    },
    {
        "id": "12e43af8a9321f2a",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "è¨­å®šå›è¦†è¨Šæ¯-image",
        "func": "msg.data.replyMsg = `å·²ç¶“å–å¾—ä½ ä¸Šå‚³çš„åœ–ç‰‡\\n imageId: ${msg.data.imageId}`\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1940,
        "y": 620,
        "wires": [
            [
                "47caebfdb8682256"
            ]
        ]
    },
    {
        "id": "d71f83e9bf2c2ff0",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "Check ID decide",
        "func": "const baseUrl = global.get(\"gas_url\");\nlet text = msg.payload?.text || msg.query || msg.data?.query || \"\";\n\n// å–å‡ºå‰é¢ç¯€é»å‚³ä¾†çš„èº«åˆ†è­‰è™Ÿ\nconst idNumber = text.trim().split(/[:ï¼š\\s ]/)[1];\n\nif (!baseUrl) {\n    node.error(\"âš ï¸ global.gas_url å°šæœªè¨­å®šï¼Œè«‹å…ˆåŸ·è¡Œåˆå§‹åŒ–ç¯€é»\");\n    return null;\n}\n\nif (!idNumber) {\n    node.error(\"âŒ æ²’æœ‰æ¥æ”¶åˆ°èº«åˆ†è­‰è™Ÿ\");\n    return null;\n}\n\n// çµ„æˆ Google Script æŸ¥è©¢ URL\nmsg.method = \"GET\";\nmsg.url = `${baseUrl}?id=${encodeURIComponent(idNumber)}`;\n\nnode.warn(`ğŸ” æŸ¥è©¢èº«åˆ†è­‰è™Ÿï¼š${idNumber}`);\nreturn msg;\n",
        "outputs": 2,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1480,
        "y": 200,
        "wires": [
            [
                "84f57caedae871dd"
            ],
            [
                "a902c61433ea3c11"
            ]
        ]
    },
    {
        "id": "84f57caedae871dd",
        "type": "http request",
        "z": "98134dc27988aaee",
        "name": "æŸ¥è©¢ Google Script API",
        "method": "use",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1880,
        "y": 200,
        "wires": [
            [
                "ae6f7cf6751ae8a3"
            ]
        ]
    },
    {
        "id": "ae6f7cf6751ae8a3",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "Format Reply",
        "func": "let data = JSON.parse(msg.payload);\nif (data.exists) {\n    msg.data.replyMsg = `âœ… å·²æ‰¾åˆ°åœ¨ç¸½è¡¨çš„è³‡æ–™ï¼š\n    å§“åï¼š${data.name}\n    é›»è©±ï¼š${data.phone}\n    æ€§åˆ¥ï¼š${data.gender}\n    é¤åˆ¥ï¼š${data.meal}\n    ç¾¤çµ„ï¼š${data.group}\n    åœ°å€ï¼š${data.city}${data.district}${data.address}`;\n} else {\n    msg.data.replyMsg = `âŒ æ²’æœ‰æŸ¥åˆ°ä½ ä¹‹å‰çš„å ±åè³‡æ–™ï¼Œè«‹é‡æ–°è¼¸å…¥æ­£ç¢ºçš„èº«åˆ†è­‰å­—è™Ÿã€‚`;\n}\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2220,
        "y": 180,
        "wires": [
            [
                "a902c61433ea3c11"
            ]
        ]
    },
    {
        "id": "63895d0c82b07973",
        "type": "http request",
        "z": "98134dc27988aaee",
        "name": "Messaging API å‚³é€",
        "method": "POST",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "https://api.line.me/v2/bot/message/reply",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 2940,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "a902c61433ea3c11",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "å‚³é€ä¿¡æ¯",
        "func": "let channelAccessToken = \"q5QZRPntU/T/BpmuRZLuamwsqd8OqRtgwwwSBo65QVVBZdglbE8IEphTsWrgWN2qvZ16ScXbmuMgUHmpE5Vv84XnXQteYZ7fpfI+7/bQMhrg7hqcuqTW3AYzuPQLMV/FE/1WkXdBSqgQNtI60gSB3gdB04t89/1O/w1cDnyilFU=\";\n\nlet message = {\n    type:'text',\n    text: `${msg.data.replyMsg}`\n};\n\nlet headers = {\n    'Content-Type': 'application/json; charset=UTF-8',\n    'Authorization': 'Bearer ' + channelAccessToken,\n};\nlet payload = {\n    \"replyToken\": msg.data.replyToken,\n    'messages': [message]\n};\nmsg.headers = headers;\nmsg.payload = payload;\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2760,
        "y": 560,
        "wires": [
            [
                "63895d0c82b07973"
            ]
        ]
    },
    {
        "id": "791355f27b03e05c",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "åˆ¤æ–·éœ€æ±‚",
        "func": "let text = msg.data.query.trim();\nlet prefix = text.split(/[:ï¼š\\s]/)[0]; // å–å‡ºå†’è™Ÿæˆ–ç©ºç™½å‰çš„æ–‡å­—\nmsg.prefix = prefix; // é¡å¤–å„²å­˜\n\nif (prefix === \"æ–°å¢\") {\n    msg.topic = \"add\";\n    return [msg, null, null, null];\n} else if (prefix === \"æŸ¥è©¢\") {\n    msg.topic = \"query\";\n    return [null, msg, null, null];\n} else if (prefix === \"å ±å\") {\n    msg.topic = \"register\";\n    return [null, null, msg, null];   \n} else {\n    msg.topic = \"other\";\n    return [null, null, null, msg];\n}\n\nreturn msg;\n",
        "outputs": 4,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1260,
        "y": 220,
        "wires": [
            [
                "2853d457b24c8c6d"
            ],
            [
                "d71f83e9bf2c2ff0"
            ],
            [
                "0d993ccc56430ee6"
            ],
            [
                "e04ef3be16c08c61"
            ]
        ]
    },
    {
        "id": "e04ef3be16c08c61",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "è¨­å®šå›è¦†è¨Šæ¯-text",
        "func": "msg.data.replyMsg = `ä½ å¥½å•Šï¼Œå¯ä»¥å‘Šè¨´èº«åˆ†è­‰å­—è™Ÿ\næˆ‘ä¾†æŸ¥æŸ¥çœ‹ç¸½è¡¨å…§æœ‰æ²’æœ‰å»ºç«‹éè³‡æ–™ğŸ˜‰\\n\nè«‹å•ä½ çš„éœ€æ±‚æ˜¯æŸ¥è©¢é‚„æ˜¯æ–°å¢ã€å ±å?\n\nã€å ±åã€‘è«‹è¼¸å…¥ \"å ±å\"+\"ç©ºæ ¼\"+\"å‡ºç™¼æ™‚é–“\"+\"ç©ºæ ¼\"+\"èº«åˆ†è­‰\"  \næé†’ï¼šå ±åå‰è«‹å…ˆæŸ¥è©¢çœ‹çœ‹æœ‰æ²’æœ‰èº«åˆ†è­‰\n\nã€æŸ¥è©¢ã€‘è«‹è¼¸å…¥ \"æŸ¥è©¢\"+\"ç©ºæ ¼\"+\"èº«åˆ†è­‰\"\n\nã€æ–°å¢ã€‘è«‹è¤‡è£½ä»¥ä¸‹æ ¼å¼è¼¸å…¥ \n\næ–°å¢ \nã€€å§“åï¼šç‹å°æ˜\nã€€æ€§åˆ¥ï¼šç”·\nã€€èº«åˆ†è­‰ï¼šA123456789\nã€€ç”Ÿæ—¥ï¼š99.04.21\nã€€é›»è©±ï¼š0912345678\nã€€é£²é£Ÿç¿’æ…£ï¼šè‘·\nã€€ç¾¤çµ„(èª°çš„æœ‹å‹)ï¼šå®®ç”Ÿ\nã€€åœ°å€ï¼šæ–°åŒ—å¸‚/æ–°èŠå€/å¹¸ç¦è·¯1è™Ÿ`\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 500,
        "wires": [
            [
                "a902c61433ea3c11"
            ]
        ]
    },
    {
        "id": "2853d457b24c8c6d",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "F1_è§£æå ±åæ–‡å­—",
        "func": "// 1) å–å¾—åŸå§‹æ–‡å­—ï¼ˆä¾ä½ å¯¦éš›ä¾†æºæ“‡ä¸€ï¼‰\nlet text = msg.payload?.text || msg.data?.query || msg.query || \"\";\ntext = text.trim();\n\n// 2) ç§»é™¤ã€Œæ–°å¢ã€èˆ‡å…¨å½¢ç©ºç™½ã€çµ±ä¸€å†’è™Ÿ\ntext = text.replace(/^æ–°å¢[\\sã€€]*/i, \"\");\ntext = text.replace(/ï¼š/g, \":\").replace(/\\r?\\n+/g, \"\\n\");\n\n// 3) é€è¡Œè§£æ\nlet lines = text.split(\"\\n\").map(s => s.replace(/ã€€/g, \"\").trim()).filter(Boolean);\nlet data = {};\nfor (let line of lines) {\n    if (/^å§“å/i.test(line)) data.name = line.split(\":\")[1]?.trim();\n    else if (/^æ€§åˆ¥/i.test(line)) data.gender = line.split(\":\")[1]?.trim();\n    else if (/^èº«åˆ†è­‰/i.test(line)) data.idNumber = line.split(\":\")[1]?.trim().toUpperCase();\n    else if (/^ç”Ÿæ—¥/i.test(line)) data.birthday = line.split(\":\")[1]?.trim(); // 99.04.21\n    else if (/^é›»è©±/i.test(line)) data.phone = line.split(\":\")[1]?.trim();\n    else if (/^(é£²é£Ÿ|é£²é£Ÿç¿’æ…£)/i.test(line)) data.meal = line.split(\":\")[1]?.trim(); // è‘·/ç´ \n    else if (/^ç¾¤çµ„/i.test(line)) data.group = line.split(\":\")[1]?.trim();\n    else if (/^åœ°å€/i.test(line)) {\n        const addr = line.split(\":\")[1]?.trim() || \"\";\n        const parts = addr.split(/[\\/ï¼]/);\n        data.city = (parts[0] || \"\").trim();    // ç¸£å¸‚ â†’ J\n        data.district = (parts[1] || \"\").trim();    // é„‰é®å¸‚å€ â†’ K\n        data.address = (parts[2] || \"\").trim();    // è·¯å â†’ Mï¼ˆL å€è™Ÿæš«ç•™ç©ºï¼‰\n    }\n}\n\n// 4) åŸºæœ¬æª¢æ ¸ï¼šèº«åˆ†è­‰æ ¼å¼ + å¿…å¡«\nlet id = data.idNumber || \"\";\nlet pattern = /^[A-Z][12]\\d{8}$/; // å°ç£èº«åˆ†è­‰\nif (!data.name || !pattern.test(id)) {\n    msg.data = msg.data || {};\n    msg.data.replyMsg = \"âŒ è³‡æ–™ä¸å®Œæ•´æˆ–èº«åˆ†è­‰æ ¼å¼éŒ¯èª¤ã€‚\\nè«‹ä¾ä¸‹åˆ—æ ¼å¼è¼¸å…¥ï¼š\\næ–°å¢ å§“åï¼šç‹å°æ˜â€¦\";\n    return [null, msg]; // ç¬¬äºŒè¼¸å‡ºï¼šå›è¦†éŒ¯èª¤\n}\n\n// 5) å°‡æ•´ç†å¥½çš„è³‡æ–™æ”¾åˆ° msg.payload ä¾›ä¸‹ä¸€æ­¥ä½¿ç”¨\nmsg.payload = {\n    name: data.name,\n    gender: data.gender,\n    idNumber: data.idNumber,\n    birthday: data.birthday,\n    phone: data.phone,\n    meal: data.meal,\n    group: data.group,\n    city: data.city || \"\",\n    district: data.district || \"\",\n    address: data.address || \"\",\n    note: \"\" // å¦‚è¦é–‹æ”¾å¯å†è§£æ\n};\nreturn msg;\n\n\n\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 140,
        "wires": [
            [
                "350853f23c5aaf27"
            ]
        ]
    },
    {
        "id": "22dd36d8f1cf9211",
        "type": "http request",
        "z": "98134dc27988aaee",
        "name": "æŸ¥è©¢ Google Script API",
        "method": "use",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 1880,
        "y": 140,
        "wires": [
            [
                "47a050455ea3ba55"
            ]
        ]
    },
    {
        "id": "bbb4dab0c25010e7",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "function 1",
        "func": "global.set(\"gas_url\", \"https://script.google.com/macros/s/AKfycbx24sLy38OPSIH_08a2kFnO7NVkOZIyr-eM4rhmin4I3ZpL_o78u_-Sd1mCSGLQVpkI/exec\");\n\nnode.warn(\"âœ… GAS URL å·²è¨­å®šå®Œæˆ\");\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 400,
        "wires": [
            [
                "390c0602fa3e523e",
                "dc29a6294a83159a",
                "0d4ebcd4a9de581f"
            ]
        ]
    },
    {
        "id": "47a050455ea3ba55",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "å‚³é€å•¥å‘¢ï¼Ÿ",
        "func": "msg.data.replyMsg = \"æˆåŠŸäº†ï¼è¨˜å¾—æ‰¾æ™‚é–“æ‰“é–‹ä½ çš„ç¸½è¡¨çœ‹çœ‹ğŸ˜\";\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2230,
        "y": 120,
        "wires": [
            [
                "a902c61433ea3c11"
            ]
        ]
    },
    {
        "id": "350853f23c5aaf27",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "F2_çµ„POSTè«‹æ±‚",
        "func": "// âœ… ç›´æ¥æŠ“ payloadï¼Œä¸è¦æŠ“ newEntry\nconst data = msg.payload;\n\nif (!data || !data.name) {\n    node.error(\"âŒ ç„¡æ³•è®€å–å ±åè³‡æ–™ï¼Œè«‹æª¢æŸ¥\", msg);\n    return null;\n}\n\nmsg.method = \"POST\";\nmsg.url = global.get(\"gas_url\");\nmsg.headers = { \"Content-Type\": \"application/json\" };\n\nmsg.payload = {\n    name: data.name,\n    gender: data.gender,\n    idNumber: data.idNumber,\n    birthday: data.birthday,\n    phone: data.phone,\n    meal: data.meal,\n    group: data.group,\n    city: data.city,\n    district: data.district,\n    address: data.address,\n    note: \"\"\n};\n\nnode.warn(\"ğŸ“¤ å‚³é€è³‡æ–™è‡³ GASï¼š\" + JSON.stringify(msg.payload));\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1650,
        "y": 40,
        "wires": [
            [
                "22dd36d8f1cf9211"
            ]
        ]
    },
    {
        "id": "0d993ccc56430ee6",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "F1_è§£æå ±åæ–‡å­—",
        "func": "// === 1) å–å¾—åŸå§‹æ–‡å­— ===\nlet text = msg.payload?.text || msg.data?.query || msg.query || \"\";\ntext = text.trim();\n\n// === 2) è§£ææ ¼å¼ï¼šå ±å [è¡¨å] [èº«åˆ†è­‰] ===\nconst match = text.match(/^å ±å[\\sã€€]+(\\S+)[\\sã€€]+([A-Z]\\d{9})$/i);\nif (!match) {\n    msg.data = msg.data || {};\n    msg.data.replyMsg = \"âš ï¸ è«‹è¼¸å…¥æ­£ç¢ºæ ¼å¼ï¼š\\nå ±å 2025.11 A123456789\";\n    return [null, msg]; // ç¬¬äºŒè¼¸å‡ºï¼šéŒ¯èª¤è¨Šæ¯\n}\n\n// === 3) æŠ½å–è³‡æ–™ ===\nlet sheetName = match[1];\nlet idNumber = match[2].toUpperCase();\n\n// === 4) é©—è­‰èº«åˆ†è­‰ ===\nconst pattern = /^[A-Z][12]\\d{8}$/;\nif (!pattern.test(idNumber)) {\n    msg.data = msg.data || {};\n    msg.data.replyMsg = \"âŒ èº«åˆ†è­‰æ ¼å¼éŒ¯èª¤ï¼Œè«‹ç¢ºèªå¾Œå†è©¦ã€‚\";\n    return [null, msg];\n}\n\n// === 5) æ‰“åŒ…åˆ° payload ä¾›ä¸‹ä¸€æ­¥ä½¿ç”¨ ===\nmsg.payload = {\n    sheetName,\n    idNumber\n};\n\n// çµ¦ä¸‹ä¸€å€‹ nodeï¼ˆF2_çµ„POSTè«‹æ±‚ï¼‰\nreturn [msg, null];",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1500,
        "y": 280,
        "wires": [
            [
                "4143ba9bd319f73e"
            ]
        ]
    },
    {
        "id": "7f55db79473862ce",
        "type": "http request",
        "z": "98134dc27988aaee",
        "name": "æŸ¥è©¢ Google Script API",
        "method": "use",
        "ret": "txt",
        "paytoqs": "ignore",
        "url": "",
        "tls": "",
        "persist": false,
        "proxy": "",
        "insecureHTTPParser": false,
        "authType": "",
        "senderr": false,
        "headers": [],
        "x": 2000,
        "y": 460,
        "wires": [
            [
                "1e67c898553d729e"
            ]
        ]
    },
    {
        "id": "1e67c898553d729e",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "å‚³é€å•¥å‘¢ï¼Ÿ",
        "func": "msg.data.replyMsg = \"æˆåŠŸäº†ï¼è¨˜å¾—æ‰¾æ™‚é–“æ‰“é–‹ä½ çš„ç¸½è¡¨çœ‹çœ‹ğŸ˜\";\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2230,
        "y": 480,
        "wires": [
            [
                "a902c61433ea3c11"
            ]
        ]
    },
    {
        "id": "4143ba9bd319f73e",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "F2_çµ„POSTè«‹æ±‚",
        "func": "msg.method = \"POST\";\nmsg.url = global.get(\"gas_url\");\nmsg.headers = { \"Content-Type\": \"application/json\" };\nmsg.payload = {\n    sheetName: msg.payload.sheetName,\n    idNumber: msg.payload.idNumber\n};\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1770,
        "y": 360,
        "wires": [
            [
                "7f55db79473862ce"
            ]
        ]
    },
    {
        "id": "init_starttime_inject",
        "type": "inject",
        "z": "98134dc27988aaee",
        "name": "init uptime",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 220,
        "y": 740,
        "wires": [
            [
                "set_starttime_fn"
            ]
        ]
    },
    {
        "id": "set_starttime_fn",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "set startTime",
        "func": "global.set('startTime', new Date().getTime());\nnode.log('ğŸ•’ startTime initialized');\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 450,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "health_http_in",
        "type": "http in",
        "z": "98134dc27988aaee",
        "name": "å¥åº·æª¢æŸ¥ç«¯é»",
        "url": "/health",
        "method": "get",
        "upload": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 880,
        "wires": [
            [
                "health_fn"
            ]
        ]
    },
    {
        "id": "health_fn",
        "type": "function",
        "z": "98134dc27988aaee",
        "name": "function/health",
        "func": "const startTime = global.get('startTime') || new Date().getTime();\nconst uptime = ((new Date().getTime() - startTime) / 1000).toFixed(1);\n\nmsg.payload = {\n  status: 'ok',\n  uptime: uptime,\n  time: new Date().toISOString()\n};\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 880,
        "wires": [
            [
                "health_http_response"
            ]
        ]
    },
    {
        "id": "health_http_response",
        "type": "http response",
        "z": "98134dc27988aaee",
        "name": "å›å‚³ 200 OK",
        "statusCode": "200",
        "headers": {
            "Content-Type": "application/json"
        },
        "x": 630,
        "y": 880,
        "wires": []
    }
]
